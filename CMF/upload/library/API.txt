Расширение ядра


1. все сообщения обрабатываются в момент preparePost. Обработка идет в несколько этапов
а). выборка всех предобработчиков(колбеков) сообщения (проверка прав, настройка полей),
 которые не требуют записи результата в кеш. все через _getPostCallbacks
    возвращает массив типа
    array(
      1 => array(
        'callback' => callback,
        'name' => callback_name (string)
      ),
      2 => array(
        'callback' => callback,
        'name' => callback_name (string)
      ),
    )
где, индексы - порядок сортировки
б). после чего если полученный массив не пустой запускаем на обработку все колбеки
 через applyPostCallbacks

в). Проверяем тип лендинга (тип кеширования - thread/news) заданный через setPostCacheType
г). аналогично пп а) и б) обрабатываем колбеки для заданного типа кеширования,
 но с использованием  _getPostCacheCallbacks


2. допмодули НЕ расширяют метод preparePost, а расширяют вспомогательные методы:
 _getPostCallbacks
 _getPostCacheCallbacks
 isValidPostCache


3. темы будут обрабатываться очень похоже (preparePost). Но т.к. прямо сейчас пока
 не понятен конкретный функционал по доп полям и когда и в какой момент их дергать
 и нужно кешировать набор колбеков или нет - то точное API будет позже
